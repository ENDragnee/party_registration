{% extends 'party_register_app/base.html' %}

{% block title %}QR Code Scanner{% endblock %}

{% block content %}
<div class="card drac-card w-100 text-center">
    <div class="card-body p-4 p-md-5">
        <h2 style="color: var(--drac-purple);">Ticket Scanner</h2>
        <p class="mb-4" style="color: var(--drac-comment);">Point your camera at a guest's QR code.</p>
        
        <div id="qr-reader" style="width: 100%; max-width: 500px; margin: auto; border-radius: 15px; overflow: hidden; border: 2px solid var(--drac-comment);"></div>
        <div id="qr-reader-results" class="mt-3"></div>
    </div>
</div>

<!-- Include the html5-qrcode library -->
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<script>
    function onScanSuccess(decodedText, decodedResult) {
        // The decodedText is the URL from the QR code.
        console.log(`Scan result: ${decodedText}`);

        // Stop the scanner
        html5QrcodeScanner.clear();

        // Redirect the browser to the scanned URL
        window.location.href = decodedText;
    }

    function onScanFailure(error) {
        // This function is called when no QR code is found. We can ignore it.
        // console.warn(`QR error: ${error}`);
    }

    // Create a new scanner instance
    let html5QrcodeScanner = new Html5QrcodeScanner(
        "qr-reader", 
        { fps: 10, qrbox: { width: 250, height: 250 } },
        /* verbose= */ false
    );
    
    // Start scanning
    html5QrcodeScanner.render(onScanSuccess, onScanFailure);
</script>
{% endblock %}
